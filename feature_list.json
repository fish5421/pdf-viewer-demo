{
  "project": "pdf-viewer-demo",
  "description": "PDF Viewer with Annotation capabilities using EmbedPDF and React",
  "created": "2025-12-08",
  "total_features": 15,
  "completed": 1,
  "features": [
    {
      "id": "infra.core.hybrid-loader",
      "layer": "infra",
      "category": "core",
      "depends_on": [],
      "description": "Load the PDF in two parallel states: a 'Visual Layer' (PDF.js) for user interaction/highlighting, and a 'Context Layer' (Base64/Binary) for the Multimodal LLM.",
      "steps": [
        "Load PDF via PDF.js for rendering the UI canvas",
        "Extract text items (with X/Y coords) specifically for creating a 'searchable map' (to sync scroll position to page numbers)",
        "Convert PDF file to Base64 string (or prepare blob) to be sent to the LLM as a 'document' or 'image' type",
        "Verify: PDF renders on screen AND the Base64 string is ready for the first API call"
      ],
      "passes": true
    },
    {
      "id": "infra.storage.persistence",
      "layer": "infra",
      "category": "state",
      "depends_on": [
        "infra.core.hybrid-loader"
      ],
      "description": "Implement IndexedDB storage to persist user data (highlights/notes) and cache the large document context to avoid re-uploading.",
      "steps": [
        "Initialize IndexedDB with stores for 'documents', 'highlights', 'user_progress', and 'cornell_notes'",
        "Store the document file handle or blob (if size permits) or hash for identification",
        "Save current page/scroll position on change",
        "Verify: Refresh browser and document opens to the exact same page"
      ],
      "passes": false
    },
    {
      "id": "infra.context.scroll-tracker",
      "layer": "infra",
      "category": "core",
      "depends_on": [
        "infra.core.hybrid-loader"
      ],
      "description": "Real-time tracking of which 'Page Number' or 'Visual Zone' the user is viewing to guide the AI.",
      "steps": [
        "Implement IntersectionObserver on PDF.js page containers",
        "Expose `window.Engram.currentView`: `{ pageNumber: 5, viewportProgress: 0.3 }`",
        "Do NOT rely on extracting perfect text for the cursor; rely on Page Numbers which the Multimodal LLM understands perfectly",
        "Verify: Scroll to Page 5, check state, confirm it reads Page 5"
      ],
      "passes": false
    },
    {
      "id": "infra.llm.client",
      "layer": "infra",
      "category": "core",
      "depends_on": [],
      "description": "Centralized service to handle Multimodal LLM API calls (Claude/Gemini) with support for file attachments.",
      "steps": [
        "Create generic `callLLM(systemPrompt, userMessage, fileContext?)` function",
        "Implement prompt caching headers (essential for large PDFs to reduce cost/latency)",
        "Implement error handling and loading states",
        "Verify: Send the PDF + 'What is the title of this book?' and get correct answer"
      ],
      "passes": false
    },
    {
      "id": "interaction.ui.overlay-manager",
      "layer": "interaction",
      "category": "selection",
      "depends_on": [],
      "description": "A Z-index management system to render full-screen overlays (for 'Prime' dashboard) or element-specific blurs (for 'Recall') over the PDF canvas.",
      "steps": [
        "Create a transparent DOM container overlaid on the PDF viewer",
        "Implement `showOverlay(type, content)` method",
        "Implement 'Blur' CSS class toggling on the main PDF viewer container",
        "Verify: Trigger overlay, confirm PDF is obscured/blurred and overlay content is clickable"
      ],
      "passes": false
    },
    {
      "id": "interaction.notebook.cornell-ui",
      "layer": "interaction",
      "category": "notes",
      "depends_on": [
        "infra.storage.persistence"
      ],
      "description": "A dedicated 'Notebook Paper' UI panel implementing the Cornell Layout (Right: Notes, Left: Cues, Bottom: Summary).",
      "steps": [
        "Create a resizeable split-screen view: PDF on left, Notebook on right",
        "Implement 3-zone layout: 'Cue Column' (30% width), 'Note Area' (70% width), 'Summary Footer'",
        "Bind input fields to IndexedDB (auto-save on typing)",
        "Verify: Type in 'Note Area', refresh page, text persists in correct column"
      ],
      "passes": false
    },
    {
      "id": "interaction.chat.panel",
      "layer": "interaction",
      "category": "chat",
      "depends_on": [
        "infra.llm.client"
      ],
      "description": "The 'Socratic Tutor' interface. A sidebar component to display the conversation history and input.",
      "steps": [
        "Build a collapsible sidebar UI component",
        "Bind input field to `infra.llm.client`",
        "Render user/assistant message bubbles with markdown support",
        "Verify: Type message, see loading state, see AI response bubble appear"
      ],
      "passes": false
    },
    {
      "id": "interaction.chat.cursor-prompt",
      "layer": "interaction",
      "category": "chat",
      "depends_on": [
        "interaction.chat.panel",
        "infra.context.scroll-tracker",
        "infra.core.hybrid-loader"
      ],
      "description": "The logic that prompts the AI to look at specific pages in its context window based on the user's scroll position.",
      "steps": [
        "Construct dynamic system prompt: 'You have the full book. The user is looking at Page {PageNum}. Answer based on this page.'",
        "Update `interaction.chat.panel` to use this dynamic prompt for all requests",
        "Verify: Scroll to page 10, ask 'What is this page about?', ensure answer cites page 10 content"
      ],
      "passes": false
    },
    {
      "id": "interaction.selection.highlighter",
      "layer": "interaction",
      "category": "highlight",
      "depends_on": [
        "infra.storage.persistence"
      ],
      "description": "The ability to select text and persist a visual highlight. Prerequisite for the '20% Rule'.",
      "steps": [
        "Capture `mouseup` events on text layer to get selection range",
        "Render visual highlight (yellow background) behind text",
        "Persist selection coordinates to IndexedDB",
        "Verify: Highlight text, refresh page, highlight remains visible"
      ],
      "passes": false
    },
    {
      "id": "cognitive.notebook.cue-generator",
      "layer": "cognitive",
      "category": "notes",
      "depends_on": [
        "interaction.notebook.cornell-ui",
        "infra.llm.client"
      ],
      "description": "AI analysis of user notes to auto-generate questions for the 'Cue Column', facilitating self-testing.",
      "steps": [
        "Add a 'Generate Cues' button to the Notebook UI",
        "Prompt LLM: 'Analyze these notes: {UserNotes}. Generate 3-5 brief recall keywords/questions for the Cue column.'",
        "Populate the Left 'Cue Column' with the response",
        "Verify: Write notes about 'Variables', click generate, see 'What is a variable?' appear in Cue column"
      ],
      "passes": false
    },
    {
      "id": "cognitive.prime.dashboard",
      "layer": "cognitive",
      "category": "prime",
      "depends_on": [
        "interaction.ui.overlay-manager",
        "infra.core.hybrid-loader",
        "infra.llm.client"
      ],
      "description": "Neuro-Hack #1: Before reading, block content and force user to review a structural map generated by AI.",
      "steps": [
        "On new chapter load, trigger `overlay-manager` to block view",
        "Prompt LLM (with full book context): 'Generate a structural JSON map of Chapter {N}'",
        "Render hierarchy in overlay",
        "Require user click 'I understand the structure' to dismiss overlay",
        "Verify: Load document, see map, cannot see text until dismissed"
      ],
      "passes": false
    },
    {
      "id": "cognitive.recall.blur-logic",
      "layer": "cognitive",
      "category": "recall",
      "depends_on": [
        "interaction.ui.overlay-manager",
        "interaction.chat.cursor-prompt",
        "infra.context.scroll-tracker"
      ],
      "description": "Neuro-Hack #4: At section breaks, blur the screen and force a retrieval question via chat.",
      "steps": [
        "Monitor scroll; detect significant whitespace/section breaks (or page boundaries)",
        "Trigger 'Blur' effect via `overlay-manager`",
        "Auto-inject prompt to Chat: 'Ask a retrieval question about Page {PrevPage}'",
        "Prevent blur removal until user replies in Chat",
        "Verify: Finish section, screen blurs, AI asks question, reply removes blur"
      ],
      "passes": false
    },
    {
      "id": "cognitive.highlight.limiter",
      "layer": "cognitive",
      "category": "highlight",
      "depends_on": [
        "interaction.selection.highlighter"
      ],
      "description": "Neuro-Hack #2: Enforce the 20% rule by calculating character density of highlights vs page text.",
      "steps": [
        "Calculate total character count of current page",
        "Calculate character count of current highlights",
        "If highlight ratio > 0.2, prevent new highlight rendering",
        "Trigger Chat warning: '20% limit reached. Summarize instead.'",
        "Verify: Highlight >20% of page, attempt next highlight, see rejection and chat message"
      ],
      "passes": false
    },
    {
      "id": "cognitive.interweaver.suggestions",
      "layer": "cognitive",
      "category": "interweave",
      "depends_on": [
        "interaction.chat.cursor-prompt",
        "infra.storage.persistence"
      ],
      "description": "Neuro-Hack #6: Proactive sidebar notifications connecting current text to previous concepts.",
      "steps": [
        "Background process: Send current page number to LLM every 2 minutes",
        "Prompt: 'Looking at Page {N}, find connections to previous chapters'",
        "If connection found, spawn a 'toast' notification in sidebar",
        "Verify: Read Chapter 3, see notification referencing Chapter 1 concept"
      ],
      "passes": false
    },
    {
      "id": "cognitive.spacing.cold-open",
      "layer": "cognitive",
      "category": "spacing",
      "depends_on": [
        "infra.storage.persistence",
        "interaction.ui.overlay-manager",
        "interaction.chat.panel"
      ],
      "description": "Neuro-Hack #3 & #8: If session gap > 24h, block reading with a retrieval prompt about the last session.",
      "steps": [
        "On load, check `last_session_timestamp` in IndexedDB",
        "If > 24 hours, trigger opaque overlay",
        "Prompt LLM: 'User last read Page {N}. Ask a retrieval question about it.'",
        "Verify: Manually set old timestamp in DB, reload, see Cold Open challenge"
      ],
      "passes": false
    }
  ]
}
